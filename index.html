<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>壓實密度計算器</title>
  <style>
    body {
      font-family: "微軟正黑體", Calibri;
      max-width: 360px;
      margin: auto;
      padding: 36px;
    }
    h2 { text-align: center; }
    label { font-weight: bold; color: #006030; }
    input {
      width: 100%;
      padding: 6px;
      margin: 6px 0 12px;
      font-size: 24px;
    }
    button {button-align: center;
      width: 100%;
      padding: 8px;
      font-size: 24px;
      font-weight: bold;
      margin-top: 8px;
    }
    #result {
      margin-top: 15px;
      font-size: 32px;
      font-weight: bold;
    }
  </style>
</head>

<body>

<h2>壓實密度計算器</h2>

<label>電極厚度 t：</label>
<input type="number" id="t" tabindex="1" autofocus>

<label>電極重量 w：</label>
<input type="number" id="w" tabindex="2">

<button id="calcBtn" onclick="calc()" tabindex ="3" >計算</button>
<button onclick="location.href='foil.html'" tabindex ="4">
  更新鋁箔常數 (W/T)
</button>

<div id="result"></div>

<script>
const DEFAULT_W = 7.7022;
const DEFAULT_T = 20;

function getFoilConstants() {
  const raw = localStorage.getItem("foil_constants_latest");
  if(!raw){
    return {W:DEFAULT_W, T:DEFAULT_T};
  }
  try {
    const obj = JSON.parse(raw);
    return {
      W: Number(obj.W),
      T: Number(obj.T)
    };
  } catch {
    return {W: DEFAULT_W, T: DEFAULT_T};
  }
}
  
function calc() {
  const {W,T} = getFoilConstantsLatest();
  const w = parseFloat(document.getElementById("w").value);
  const t = parseFloat(document.getElementById("t").value);

  if (isNaN(w) || isNaN(t)) {
    alert("請輸入完整數值");
    return;
  }
  
  if (t <= T) {
    alert("電極厚度必須大於鋁箔厚度");
    return;
  }

  const D = (w - W) / (t - T) / 1.43138 * 10;
  document.getElementById("result").innerText =
    "壓實密度 D = " + D.toFixed(2);
}

const focusables = [
  document.getElementById("t"),
  document.getElementById("w"),
  document.getElementById("calcBtn")
];

function focusNext() {
  const i = focusables.indexOf(document.activeElement);
  const next = (i+1)% focusables.length;
  focusables[next].focus();
}

function focusPrev() {
  const i = focusables.indexOf(document.activeElement);
  const prev = (i-1 + focusables.length) % focusables.length;
  focusables[prev].focus();
}

function clearCurrent() {
  const el = document.activeElement;
  if (el && el.tagName === "INPUT") {
    el.value = "";
  }
}

document.addEventListener("keydown", function (e) {

  const key =e.code;

  switch (key) {

    case "NumpadAdd":
      e.preventDefault();
      focusNext();
      break;

    case "NumpadSubstract":
      e.preventDefault();
      focusPrev();
      break;

    case "NumpadEnter":
      e.preventDefault();
      document.getElementById("calcBtn").click();
      break;

    case "NumberMultiply":
      e.preventDefault();
      window.location.href = "foil.html";
      break;

    case "NumpadDivide":
      e.preventDefault();
      window.location.href = "index.html";
      break;

    case "Escape":
      e.preventDefault();
      clearCurrent();
      break;
  }
});
</script>

</body>
</html>






